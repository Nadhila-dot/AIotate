(function() {
  'use strict';

  // Check sessionStorage to see if loader was shown before
  if (sessionStorage.getItem('vela-loader-shown')) {
    return;
  }

  // Load GSAP if not already loaded
  if (typeof gsap === 'undefined') {
    const script = document.createElement('script');
    script.src = 'https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.5/gsap.min.js';
    script.onload = initLoader;
    document.head.appendChild(script);
  } else {
    initLoader();
  }

  function initLoader() {
    // Load font
    const fontLink = document.createElement('link');
    fontLink.href = 'https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@600&display=swap';
    fontLink.rel = 'stylesheet';
    document.head.appendChild(fontLink);

    // Create loader container
    const loader = document.createElement('div');
    loader.id = 'vela-loader';
    loader.innerHTML = `
      <div class="vela-loader-content">
        <svg class="vela-logo-svg" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1500 1500" width="240" height="240">
          <defs>
            <clipPath id="circle-clip">
              <circle cx="750" cy="750" r="447.42"/>
            </clipPath>
          </defs>
          
          <!-- Outer circle stroke (will be animated) -->
          <circle 
            class="logo-outer-stroke" 
            cx="750" 
            cy="750" 
            r="447.42" 
            fill="none" 
            stroke="#ffffff" 
            stroke-width="8"
            opacity="0.9"
          />
          
          <!-- Inner logo group (will fade in and scale) -->
          <g class="logo-inner-mark" opacity="0">
            <!-- White circle background -->
            <g clip-path="url(#circle-clip)">
              <circle cx="738.96" cy="721.25" r="447.42" fill="#ffffff" transform="translate(11.04, 28.75)"/>
            </g>
            
            <!-- Black diagonal bars -->
            <g class="logo-bars">
              <path d="M 447.007812 481.765625 C 443.855469 485.15625 440.761719 488.601562 437.730469 492.101562 C 434.699219 495.605469 431.730469 499.160156 428.828125 502.769531 C 425.921875 506.375 423.085938 510.035156 420.3125 513.746094 C 417.542969 517.457031 414.839844 521.21875 412.203125 525.023438 C 409.566406 528.832031 407 532.6875 404.5 536.589844 C 402.003906 540.488281 399.578125 544.433594 397.222656 548.421875 C 394.867188 552.410156 392.582031 556.4375 390.371094 560.507812 C 388.160156 564.578125 386.027344 568.6875 383.964844 572.835938 C 381.902344 576.984375 379.914062 581.167969 378 585.386719 C 376.089844 589.605469 374.253906 593.855469 372.496094 598.140625 C 370.738281 602.425781 369.054688 606.742188 367.453125 611.089844 C 365.847656 615.433594 364.324219 619.808594 362.878906 624.207031 C 361.433594 628.609375 360.066406 633.035156 358.777344 637.484375 C 357.492188 641.933594 356.285156 646.40625 355.160156 650.898438 C 354.035156 655.394531 352.988281 659.90625 352.027344 664.4375 C 351.0625 668.96875 350.179688 673.515625 349.382812 678.078125 C 348.582031 682.640625 347.863281 687.21875 347.230469 691.808594 C 346.59375 696.398438 346.042969 700.996094 345.574219 705.605469 C 345.105469 710.214844 344.71875 714.828125 344.414062 719.453125 C 344.113281 724.078125 343.890625 728.703125 343.753906 733.335938 C 343.617188 737.964844 343.566406 742.597656 343.59375 747.230469 C 343.625 751.863281 343.738281 756.496094 343.933594 761.125 C 344.132812 765.753906 344.410156 770.378906 344.773438 774.996094 C 345.136719 779.617188 345.582031 784.226562 346.113281 788.832031 C 346.640625 793.433594 347.253906 798.027344 347.949219 802.609375 C 348.640625 807.191406 349.417969 811.757812 350.277344 816.3125 C 351.136719 820.863281 352.078125 825.402344 353.097656 829.921875 C 354.121094 834.441406 355.222656 838.941406 356.40625 843.421875 C 357.589844 847.902344 358.855469 852.359375 360.199219 856.796875 C 361.542969 861.230469 362.96875 865.640625 364.46875 870.023438 C 365.972656 874.40625 367.554688 878.761719 369.214844 883.089844 C 370.875 887.417969 372.609375 891.710938 374.425781 895.976562 C 376.238281 900.242188 378.128906 904.472656 380.097656 908.667969 C 382.0625 912.867188 384.105469 917.027344 386.21875 921.148438 C 388.335938 925.273438 390.523438 929.355469 392.789062 933.402344 C 395.050781 937.445312 397.386719 941.449219 399.792969 945.410156 C 402.199219 949.371094 404.679688 953.285156 407.226562 957.160156 C 409.773438 961.03125 412.390625 964.855469 415.074219 968.632812 C 417.761719 972.410156 420.515625 976.136719 423.332031 979.816406 C 426.152344 983.496094 429.039062 987.121094 431.988281 990.699219 C 434.9375 994.273438 437.953125 997.792969 441.027344 1001.261719 C 444.105469 1004.726562 447.242188 1008.136719 450.441406 1011.492188 C 453.640625 1014.84375 456.898438 1018.140625 460.21875 1021.375 C 463.535156 1024.613281 466.910156 1027.789062 470.34375 1030.902344 C 473.773438 1034.019531 477.261719 1037.070312 480.804688 1040.0625 C 484.34375 1043.050781 487.9375 1045.976562 491.585938 1048.835938 C 495.234375 1051.695312 498.929688 1054.492188 502.679688 1057.21875 C 506.425781 1059.945312 510.21875 1062.605469 514.0625 1065.195312 C 517.90625 1067.785156 521.796875 1070.308594 525.730469 1072.757812 C 529.664062 1075.210938 533.640625 1077.589844 537.65625 1079.898438 C 541.675781 1082.207031 545.738281 1084.441406 549.835938 1086.601562 C 553.9375 1088.765625 558.074219 1090.851562 562.246094 1092.863281 C 566.421875 1094.878906 570.632812 1096.816406 574.875 1098.675781 C 579.121094 1100.539062 583.394531 1102.324219 587.703125 1104.03125 C 592.011719 1105.738281 596.351562 1107.371094 600.714844 1108.921875 C 605.082031 1110.472656 609.476562 1111.945312 613.894531 1113.339844 C 618.316406 1114.734375 622.757812 1116.046875 627.226562 1117.28125 C 631.691406 1118.515625 636.179688 1119.667969 640.6875 1120.738281 C 645.199219 1121.8125 649.722656 1122.804688 654.265625 1123.714844 C 658.8125 1124.621094 663.371094 1125.449219 667.941406 1126.195312 C 672.515625 1126.941406 677.101562 1127.605469 681.699219 1128.183594 C 686.296875 1128.765625 690.902344 1129.261719 695.515625 1129.675781 C 700.132812 1130.089844 704.753906 1130.421875 709.378906 1130.671875 C 714.007812 1130.917969 718.636719 1131.085938 723.269531 1131.167969 C 729.4375 1131.285156 735.605469 1131.25 741.773438 1131.070312 C 747.941406 1130.890625 754.101562 1130.558594 760.253906 1130.082031 C 766.402344 1129.605469 772.539062 1128.976562 778.660156 1128.203125 C 784.78125 1127.429688 790.878906 1126.507812 796.957031 1125.441406 C 803.03125 1124.371094 809.078125 1123.15625 815.097656 1121.796875 C 821.113281 1120.4375 827.09375 1118.933594 833.039062 1117.28125 C 838.984375 1115.632812 844.886719 1113.84375 850.742188 1111.910156 C 856.601562 1109.976562 862.410156 1107.902344 868.167969 1105.6875 C 873.925781 1103.472656 879.625 1101.121094 885.269531 1098.632812 C 890.914062 1096.144531 896.492188 1093.519531 902.011719 1090.761719 C 907.527344 1088 912.976562 1085.113281 918.351562 1082.089844 C 923.730469 1079.066406 929.03125 1075.917969 934.257812 1072.640625 C 939.484375 1069.363281 944.625 1065.960938 949.6875 1062.4375 C 954.75 1058.910156 959.722656 1055.265625 964.605469 1051.5 C 969.492188 1047.734375 974.28125 1043.851562 978.980469 1039.855469 C 983.675781 1035.855469 988.277344 1031.75 992.773438 1027.53125 L 1002.5625 1018.363281 L 456.175781 471.976562 Z M 447.007812 481.765625" fill="#000000"/>
              
              <path d="M 1041.058594 980.328125 C 1044.214844 976.941406 1047.308594 973.492188 1050.339844 969.992188 C 1053.371094 966.492188 1056.335938 962.933594 1059.242188 959.328125 C 1062.144531 955.71875 1064.980469 952.058594 1067.753906 948.347656 C 1070.527344 944.636719 1073.230469 940.878906 1075.867188 937.070312 C 1078.503906 933.261719 1081.070312 929.40625 1083.566406 925.507812 C 1086.066406 921.605469 1088.492188 917.660156 1090.847656 913.671875 C 1093.203125 909.683594 1095.484375 905.65625 1097.695312 901.585938 C 1099.90625 897.515625 1102.042969 893.40625 1104.105469 889.257812 C 1106.167969 885.113281 1108.15625 880.929688 1110.066406 876.710938 C 1111.976562 872.488281 1113.8125 868.238281 1115.574219 863.953125 C 1117.332031 859.667969 1119.011719 855.351562 1120.617188 851.007812 C 1122.21875 846.660156 1123.742188 842.289062 1125.191406 837.886719 C 1126.636719 833.484375 1128.003906 829.058594 1129.289062 824.609375 C 1130.574219 820.160156 1131.78125 815.6875 1132.90625 811.195312 C 1134.035156 806.699219 1135.078125 802.1875 1136.042969 797.65625 C 1137.003906 793.125 1137.886719 788.578125 1138.6875 784.015625 C 1139.484375 779.453125 1140.203125 774.875 1140.835938 770.289062 C 1141.472656 765.699219 1142.023438 761.097656 1142.496094 756.488281 C 1142.964844 751.878906 1143.351562 747.265625 1143.652344 742.640625 C 1143.957031 738.019531 1144.175781 733.390625 1144.3125 728.761719 C 1144.449219 724.128906 1144.503906 719.496094 1144.472656 714.863281 C 1144.441406 710.230469 1144.328125 705.597656 1144.132812 700.96875 C 1143.9375 696.339844 1143.65625 691.714844 1143.292969 687.097656 C 1142.929688 682.476562 1142.484375 677.867188 1141.953125 673.261719 C 1141.425781 668.660156 1140.8125 664.066406 1140.121094 659.484375 C 1139.425781 654.90625 1138.648438 650.335938 1137.789062 645.78125 C 1136.929688 641.230469 1135.992188 636.691406 1134.96875 632.171875 C 1133.949219 627.652344 1132.84375 623.152344 1131.660156 618.671875 C 1130.476562 614.191406 1129.210938 609.734375 1127.867188 605.300781 C 1126.523438 600.863281 1125.101562 596.453125 1123.597656 592.070312 C 1122.09375 587.6875 1120.511719 583.332031 1118.855469 579.003906 C 1117.195312 574.675781 1115.457031 570.382812 1113.644531 566.117188 C 1111.828125 561.851562 1109.9375 557.621094 1107.972656 553.425781 C 1106.003906 549.226562 1103.964844 545.066406 1101.847656 540.945312 C 1099.730469 536.820312 1097.542969 532.738281 1095.28125 528.691406 C 1093.015625 524.648438 1090.679688 520.644531 1088.273438 516.683594 C 1085.867188 512.722656 1083.390625 508.808594 1080.84375 504.9375 C 1078.292969 501.0625 1075.675781 497.238281 1072.992188 493.460938 C 1070.304688 489.683594 1067.554688 485.957031 1064.734375 482.277344 C 1061.914062 478.597656 1059.03125 474.972656 1056.078125 471.398438 C 1053.128906 467.820312 1050.117188 464.300781 1047.039062 460.835938 C 1043.964844 457.367188 1040.824219 453.957031 1037.625 450.605469 C 1034.425781 447.25 1031.167969 443.957031 1027.851562 440.71875 C 1024.53125 437.480469 1021.15625 434.304688 1017.726562 431.191406 C 1014.292969 428.074219 1010.804688 425.023438 1007.265625 422.035156 C 1003.722656 419.042969 1000.128906 416.117188 996.480469 413.257812 C 992.835938 410.398438 989.136719 407.605469 985.390625 404.875 C 981.640625 402.148438 977.847656 399.488281 974.003906 396.898438 C 970.160156 394.308594 966.273438 391.785156 962.339844 389.335938 C 958.40625 386.886719 954.429688 384.503906 950.410156 382.199219 C 946.390625 379.890625 942.332031 377.652344 938.230469 375.492188 C 934.132812 373.332031 929.996094 371.242188 925.820312 369.230469 C 921.644531 367.214844 917.4375 365.277344 913.191406 363.417969 C 908.949219 361.554688 904.671875 359.769531 900.363281 358.0625 C 896.054688 356.355469 891.71875 354.726562 887.351562 353.171875 C 882.984375 351.621094 878.589844 350.148438 874.171875 348.753906 C 869.75 347.363281 865.308594 346.046875 860.839844 344.8125 C 856.375 343.578125 851.886719 342.425781 847.378906 341.355469 C 842.871094 340.28125 838.34375 339.292969 833.800781 338.382812 C 829.257812 337.472656 824.699219 336.644531 820.125 335.898438 C 815.550781 335.152344 810.964844 334.492188 806.367188 333.910156 C 801.769531 333.328125 797.164062 332.832031 792.550781 332.417969 C 787.933594 332.003906 783.3125 331.671875 778.6875 331.421875 C 774.0625 331.175781 769.429688 331.007812 764.796875 330.929688 C 758.628906 330.8125 752.460938 330.84375 746.292969 331.023438 C 740.125 331.203125 733.964844 331.535156 727.816406 332.011719 C 721.664062 332.492188 715.527344 333.117188 709.40625 333.890625 C 703.285156 334.664062 697.1875 335.585938 691.113281 336.65625 C 685.035156 337.722656 678.988281 338.9375 672.972656 340.296875 C 666.953125 341.65625 660.972656 343.164062 655.027344 344.8125 C 649.082031 346.460938 643.183594 348.253906 637.324219 350.1875 C 631.464844 352.121094 625.660156 354.195312 619.902344 356.40625 C 614.144531 358.621094 608.441406 360.972656 602.796875 363.460938 C 597.15625 365.953125 591.574219 368.574219 586.054688 371.335938 C 580.539062 374.09375 575.09375 376.984375 569.714844 380.003906 C 564.335938 383.027344 559.035156 386.175781 553.808594 389.453125 C 548.585938 392.730469 543.441406 396.132812 538.378906 399.660156 C 533.320312 403.183594 528.347656 406.828125 523.460938 410.597656 C 518.578125 414.363281 513.785156 418.242188 509.089844 422.242188 C 504.390625 426.238281 499.792969 430.347656 495.292969 434.566406 L 485.503906 443.730469 L 1031.894531 990.117188 Z M 1041.058594 980.328125" fill="#000000"/>
            </g>
            
            <!-- Red accent line -->
            <path stroke-linecap="butt" transform="matrix(0.564175, -0.494172, 0.494172, 0.564175, 422.074485, 969.587944)" fill="none" stroke-linejoin="miter" d="M -0.00185336 37.501165 L 1051.035912 37.49941" stroke="#d82629" stroke-width="75" stroke-opacity="1" stroke-miterlimit="4"/>
          </g>
        </svg>
      </div>
    `;

    // Inject styles
    const style = document.createElement('style');
    style.textContent = `
      #vela-loader {
        position: fixed;
        top: 0;
        left: 0;
        width: 100vw;
        height: 100vh;
        background: #000000;
        z-index: 999999;
        display: flex;
        align-items: center;
        justify-content: center;
        overflow: hidden;
      }

      #vela-loader * {
        box-sizing: border-box;
      }

      .vela-loader-content {
        position: relative;
        display: flex;
        align-items: center;
        justify-content: center;
      }

      .vela-logo-svg {
        width: 240px;
        height: 240px;
        filter: drop-shadow(0 0 40px rgba(255, 255, 255, 0.15));
      }

      .logo-outer-stroke {
        stroke-dasharray: 2810;
        stroke-dashoffset: 2810;
      }

      @media (max-width: 768px) {
        .vela-logo-svg {
          width: 180px;
          height: 180px;
        }
      }
    `;

    document.head.appendChild(style);
    document.body.appendChild(loader);

    // Start GSAP animation
    startAnimation();
  }

  function startAnimation() {
    const loader = document.getElementById('vela-loader');
    const svg = loader.querySelector('.vela-logo-svg');
    const outerStroke = loader.querySelector('.logo-outer-stroke');
    const innerMark = loader.querySelector('.logo-inner-mark');

    // Set transform origin for rotation
    gsap.set(svg, { 
      transformOrigin: "50% 50%"
    });
    
    gsap.set(innerMark, { 
      transformOrigin: "50% 50%",
      scale: 0.95,
      opacity: 0
    });

    // Create master timeline
    const tl = gsap.timeline({
      onComplete: () => {
        // Wait 1.2 seconds then exit
        setTimeout(exitLoader, 1200);
      }
    });

    // 1. Stroke Draw Animation (0.9s)
    // Simultaneously rotate the entire SVG with mechanical precision
    tl.to(outerStroke, {
      strokeDashoffset: 0,
      duration: 0.9,
      ease: "power2.out"
    }, 0)
    
    // 2. Subtle Rotation During Draw (mechanical, engineered feel)
    .to(svg, {
      rotation: 20,
      duration: 0.9,
      ease: "power2.out"
    }, 0)
    
    // 3. Inner Mark Reveal (starts at 70% of stroke animation = 0.63s)
    .to(innerMark, {
      opacity: 1,
      scale: 1,
      duration: 0.5,
      ease: "power3.out"
    }, 0.63)
    
    // 4. Settle - micro ease back to perfect stillness
    .to(svg, {
      rotation: 0,
      duration: 0.4,
      ease: "power2.inOut"
    }, 1.1);

    // Optional: Ultra-slow idle rotation after completion (disabled by default)
    const enableIdleRotation = false;
    
    if (enableIdleRotation) {
      tl.to(svg, {
        rotation: 360,
        duration: 600, // 10 minutes = 0.1 RPM
        ease: "none",
        repeat: -1
      }, "+=0.5");
    }

    // Click anywhere to exit early
    loader.addEventListener('click', exitLoader);

    function exitLoader() {
      // Remove click listener
      loader.removeEventListener('click', exitLoader);
      
      // Set sessionStorage flag
      sessionStorage.setItem('vela-loader-shown', 'true');

      // Create exit timeline
      const exitTl = gsap.timeline({
        onComplete: () => {
          loader.remove();
        }
      });

      // Fade out with slight scale
      exitTl.to(svg, {
        scale: 1.05,
        opacity: 0,
        duration: 0.5,
        ease: "power2.in"
      })
      .to(loader, {
        opacity: 0,
        duration: 0.4,
        ease: "power2.in"
      }, 0.3);
    }
  }
})();